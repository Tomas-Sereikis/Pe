!function(){function a(){}function b(){if(this instanceof b==!1)throw new ReferenceError;var a=t(this),c=[],d=[],e=[],f=[],g=[],h=!1,i=!1;Object.defineProperties(this,{$stack:{writable:!1,value:c},$workers:{writable:!1,value:d},$processing:{writable:!1,value:e},$callbacks:{writable:!1,value:f},$fails:{writable:!1,value:g},$closed:{enumerable:!0,get:function(){return h},set:function(a){if("boolean"!=typeof a)throw new TypeError;h===!1&&(h=a)}},$locked:{enumerable:!0,get:function(){return i},set:function(a){if("boolean"!=typeof a)throw new TypeError;i=a}},on:{enumerable:!0,get:function(){return a}}})}var c=this;a.prototype=new Error;var d=function(a){if("function"!=typeof a)throw new TypeError},e=function(a,b,c){var d=!1,e=!1,f={async:function(){return d=!0,function(){e===!1&&b()}},fail:function(a){e=!0,c(a)}};a.worker.apply(f,a.params),d||e!==!1||b()},f=function(a,b){var c=[];return a.$stack.forEach(function(d){var e="undefined"==typeof d.position?-1:d.position;b>e&&(d.position=b,c.push({worker:a.$workers[b],params:d.params}))}),c},g=function(a){a.$workers.forEach(function(b,c){s(a,f(a,c))})},h=function(a,b){n(a),l(a,b)},i=function(a,b){a.$fails.forEach(function(a){a(b)})},j=function(a,b){"function"==typeof b&&a.$callbacks.push(b)},k=function(a){for(var b;b=a.$callbacks.shift();)b()},l=function(a,b){if(a.isLocked())return void j(a,b);if(a.$processing.length>0){m(a);var c=a.$processing.shift();try{var d=function(){h(a,b)},f=function(c){i(a,c),h(a,b)};e(c,d,f)}catch(g){i(a,g),h(a,b)}}else n(a),"function"==typeof b&&b(),k(a)},m=function(a){a.$locked=!0},n=function(a){a.$locked=!1},o=function(a){a.$closed=!0},p=function(b){if(b.$closed)throw new a},q=function(a,b){a.$stack.push({params:b})},r=function(a,b){return a.$workers.push(b),a.$workers.length-1},s=function(a,b){b.forEach(function(b){a.$processing.push(b)})},t=function(a){return{fail:function(b){return d(b),-1===a.$fails.indexOf(b)&&a.$fails.push(b),a}}};b.stackFromArray=function(){var a=new b;return[].forEach.call(arguments,function(b){a.push(b)}),a},b.prototype={push:function(a){return p(this),a=Array.prototype.slice.call(arguments),q(this,a),g(this),l(this),this},evaluate:function(a){d(a),p(this);var b=r(this,a);return s(this,f(this,b)),l(this),this},"catch":function(a){return d(a),this.on.fail(a),this},finish:function(a){d(a),o(this),l(this,a)},isLocked:function(){return this.$locked},isClosed:function(){return this.$closed}};var u=c.Pe;c.Pe=b,c.Pe.noConflict=function(){return c.Pe=u,b}}();
//# sourceMappingURL=pe.min.js.map